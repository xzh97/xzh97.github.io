<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="xzh">


    <meta name="subtitle" content="ä½•é¡»ä»°æœ›ä»–äººï¼Œè‡ªå·±äº¦æ˜¯é£æ™¯">


    <meta name="description" content="xzhçš„ä¸ªäººåšå®¢">


    <meta name="keywords" content="xzh,åšå®¢">


<title>Vueæºç å­¦ä¹ ï¼ˆä¸€ï¼‰ï¼šå“åº”å¼-1 | è¿½æ¢¦çš„èš‚èš</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/gitalk/1.7.0/gitalk.min.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    
    <script src="https://cdn.bootcdn.net/ajax/libs/gitalk/1.7.0/gitalk.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="è¿½æ¢¦çš„èš‚èš" type="application/atom+xml">
</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">xzh97&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">xzh97&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Vueæºç å­¦ä¹ ï¼ˆä¸€ï¼‰ï¼šå“åº”å¼-1</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">xzh</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">May 12, 2020&nbsp;&nbsp;12:39:34</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€"></a>å‰è¨€</h3>
<p>é¦–å…ˆå£°æ˜ä¸€ä¸‹ï¼Œæœ¬æ¥è®¡åˆ’æ˜¯ä¸€æœˆä¸€ç¯‡ï¼Œä¸‰æœˆåŠ äº†ä¸€æ•´ä¸ªæœˆçš„ç­ï¼Œ9107çš„è¿™ç§ï¼ŒçœŸæŒºç´¯çš„ã€‚æ‰€ä»¥å››æœˆä»½å°±æ²¡æœ‰å†™äº†ï¼Œè€Œä¸”æœ€è¿‘è§‰å¾—æœ‰é“äº‘ç¬”è®°æŒºå¥½ç”¨ï¼Œæ‰€ä»¥å¾ˆå¤šä¸œè¥¿éƒ½å…ˆåœ¨æœ‰é“äº‘é‡Œå†™äº†ã€‚å°±çœ‹åé¢å•¥æ—¶å€™æœ‰ç©ºè´´å‡ºæ¥ã€‚å¥½äº†ï¼Œæ­¥å…¥æ­£é¢˜ã€‚å…¶å®åœ¨è¿™ä¹‹å‰å‘¢ï¼Œå°±é™†é™†ç»­ç»­çš„é˜…è¯»è¿‡<code>vue2</code>çš„æºç ï¼Œä½†æ˜¯çœ‹çš„éƒ½é›¶é›¶æ•£æ•£çš„ï¼Œè¿™æ¬¡å†³å®šæ¥ç³»ç»Ÿçš„è§£è¯»ä¸‹<code>vue2</code>çš„æºç ï¼Œå¸Œæœ›è‡ªå·±èƒ½å¯¹<code>vue2</code>æŒæ¡çš„æ›´åŠ æ·±åˆ»ä»¥åŠæå‡è‡ªå·±çš„æ°´å¹³ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦è§£è¯»ä¸€ä¸‹<code>vue2</code>çš„å“åº”å¼åŸç†ï¼Œwhyï¼Ÿ å› ä¸ºè¿™ä¸ªé—®é¢˜å®åœ¨æ˜¯å¤ªå¸¸è§äº†ã€‚ğŸ˜œ</p>
<h3 id="è¿‡ç¨‹å›¾"><a class="header-anchor" href="#è¿‡ç¨‹å›¾"></a>è¿‡ç¨‹å›¾</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">æœ‰é“äº‘ç¬”è®°çš„è¿‡ç¨‹å›¾å®åœ¨å¤ªä¸‘äº†ï¼Œæˆ‘ä¹‹åç”¨å…¶ä»–çš„è½¯ä»¶ç”»ä¸€ä¸ªQWQ</span><br><span class="line">&lt;!--graph TD</span><br><span class="line">    A[data&#x2F;props]</span><br><span class="line">    A --&gt; B(defineReactive)</span><br><span class="line">    B --&gt; |tracking| D[ä¾èµ–æ”¶é›†]</span><br><span class="line">    B --&gt; |trigger| E[è§¦å‘]</span><br><span class="line">    D --&gt; |depend| F[Dep]</span><br><span class="line">    E --&gt; |notify| F[Dep]</span><br><span class="line">    </span><br><span class="line">    G[computed]</span><br><span class="line">    G --&gt; H(computedWatcher)</span><br><span class="line">    H --&gt; |tracking| I[ä¾èµ–æ”¶é›†]</span><br><span class="line">    H --&gt; |trigger| J[ä¾èµ–æ”¶é›†]</span><br><span class="line">    I --&gt; |depend| F[Dep]</span><br><span class="line">    J --&gt; |notify| F[Dep]</span><br><span class="line">    </span><br><span class="line">    K[watch]</span><br><span class="line">    K --&gt; L(Watcher)</span><br><span class="line">    L --&gt; |update| F[Dep]</span><br><span class="line">    L --&gt; |addDep| F[Dep]</span><br><span class="line">    L --&gt; |run| M(callback)</span><br><span class="line">    </span><br><span class="line">    N[$mount]</span><br><span class="line">    N --&gt; O(render watcher)</span><br><span class="line">    N --&gt; P(updateComponent)</span><br><span class="line">    N --&gt; |update| F[Dep]</span><br><span class="line">    N --&gt; |addDep| F[Dep]--&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Object-defineProperty"><a class="header-anchor" href="#Object-defineProperty"></a>Object.defineProperty</h3>
<blockquote>
<p>Object.defineProperty()ï¼Œå®ƒä¼šåœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§å¹¶è¿”å›æ­¤å¯¹è±¡</p>
</blockquote>
<p>vueçš„å“åº”å¼ä¸»è¦æ˜¯é€šè¿‡<code>Object.defineProperty()</code>æ¥å®Œæˆçš„ã€‚ä½†ç”±äº<code>Object.defineProperty()</code>æ˜¯<code>ES5</code>çš„å†…å®¹ï¼Œæ‰€ä»¥<code>vue</code>æœ¬èº«å…¼å®¹ä¸äº†<code>ie8</code>ã€‚è¿™é‡Œå¤§è‡´è¯´æ˜ä¸€ä¸‹<code>Object.defineProperty()</code>çš„ä½œç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  name: <span class="string">'zh'</span>,</span><br><span class="line">  age: <span class="string">'23'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢çš„èµ‹å€¼ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">let</span> obj1 = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj1, <span class="string">'name'</span>, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    value: <span class="string">'zh'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj1, <span class="string">'age'</span>, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å¯æšä¸¾</span></span><br><span class="line">    configurable: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å¯ä»¥è¢«æ”¹å˜ä»¥åŠè¢«åˆ é™¤</span></span><br><span class="line">    writable: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å¯ä»¥è¢«èµ‹å€¼</span></span><br><span class="line">    value: <span class="number">23</span> <span class="comment">// èµ‹å€¼ï¼Œ ä¸å†™value é»˜è®¤èµ‹å€¼undefined</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// enumerableï¼Œconfigurableï¼Œwritableï¼Œvalueè¢«ç§°ä¸ºæ•°æ®æè¿°ç¬¦ï¼Œ</span></span><br><span class="line"><span class="comment">// enumerableï¼Œconfigurableï¼Œget(),set()è¢«ç§°ä¸ºå­˜å–æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">//enumerableï¼ŒconfigurableåŒæ—¶æ˜¯ä¸¤ç§æè¿°ç¬¦ï¼Œæ•°æ®æè¿°ç¬¦å’Œå­˜å–æè¿°ç¬¦ä¸èƒ½åŒæ—¶å­˜åœ¨ï¼ŒåŒæ—¶å­˜åœ¨æ—¶ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(obj).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj,key,&#123;</span><br><span class="line">    <span class="comment">// æ˜¯ä¸€ä¸ªç»™keyæä¾›çš„getteræ–¹æ³•ï¼Œå½“æˆ‘ä»¬ è®¿é—® è¯¥keyå€¼çš„æ—¶å€™ä¼šè¢«è§¦å‘</span></span><br><span class="line">    <span class="keyword">get</span>()&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`get<span class="subst">$&#123;key&#125;</span>`</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æ˜¯ä¸€ä¸ªç»™keyæä¾›çš„setteræ–¹æ³•ï¼Œå½“æˆ‘ä»¬ æ”¹å˜ è¯¥keyå€¼çš„æ—¶å€™ä¼šè¢«è§¦å‘</span></span><br><span class="line">    <span class="keyword">set</span>(newVal)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`setå˜åŒ–ï¼Œ<span class="subst">$&#123;key&#125;</span>çš„newValæ˜¯<span class="subst">$&#123;newVal&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> newVal;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(obj.age);</span><br><span class="line">obj.name = <span class="string">'zh1'</span>;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ç»™<code>obj</code>è®¾ç½®å¥½äº†<code>get</code>å’Œ<code>set</code>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•çš„æŠŠè¿™ä¸ªå¯¹è±¡ç§°ä¸ºæ˜¯ä¸€ä¸ªå“åº”å¼å¯¹è±¡ã€‚é‚£ä¹ˆï¼Œ<code>vue</code>ä¸­çš„å“åº”å¼å¯¹è±¡ç©¶ç«Ÿæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p>
<h3 id="å“åº”å¼å¯¹è±¡å…¥å£"><a class="header-anchor" href="#å“åº”å¼å¯¹è±¡å…¥å£"></a>å“åº”å¼å¯¹è±¡å…¥å£</h3>
<p>æƒ³äº†è§£å“åº”å¼ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹<code>vue</code>çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vueçš„æœ€åˆå…¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vue</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp;</span><br><span class="line">    !(<span class="keyword">this</span> <span class="keyword">instanceof</span> Vue)</span><br><span class="line">  ) &#123;</span><br><span class="line">    warn(<span class="string">'Vue is a constructor and should be called with the `new` keyword'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>._init(options) </span><br><span class="line">  <span class="comment">// æˆ‘ä»¬å¯ä»¥çœ‹åˆ°vueè°ƒç”¨æ—¶å…¶å®å°±è°ƒç”¨äº†ä¸€ä¸ª_initæ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®šä¹‰äº†_initæ–¹æ³•</span></span><br><span class="line">initMixin(Vue)</span><br><span class="line"><span class="comment">// æ·»åŠ æ•°æ®ç›¸å…³å¤„ç†æ–¹æ³•ï¼Œ$set,$delete,$watch</span></span><br><span class="line">stateMixin(Vue)  </span><br><span class="line"><span class="comment">// æ·»åŠ äº‹ä»¶æ–¹æ³•ï¼Œ$on,$once,$off,$emit</span></span><br><span class="line">eventsMixin(Vue)</span><br><span class="line"><span class="comment">// æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œ _update,$forceUpdate,$destory</span></span><br><span class="line">lifecycleMixin(Vue)</span><br><span class="line"><span class="comment">// æ·»åŠ æ¸²æŸ“ç›¸å…³å¤„ç† $nextTick, _render</span></span><br><span class="line">renderMixin(Vue)</span><br><span class="line"></span><br><span class="line"><span class="comment">// _initæ–¹æ³•å†…å®¹</span></span><br><span class="line">Vue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options?: Object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">    <span class="comment">// a uid</span></span><br><span class="line">    vm._uid = uid++</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> startTag, endTag</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">      startTag = <span class="string">`vue-perf-start:<span class="subst">$&#123;vm._uid&#125;</span>`</span></span><br><span class="line">      endTag = <span class="string">`vue-perf-end:<span class="subst">$&#123;vm._uid&#125;</span>`</span></span><br><span class="line">      mark(startTag)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a flag to avoid this being observed</span></span><br><span class="line">    vm._isVue = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// merge options</span></span><br><span class="line">    <span class="keyword">if</span> (options &amp;&amp; options._isComponent) &#123;</span><br><span class="line">      <span class="comment">// optimize internal component instantiation</span></span><br><span class="line">      <span class="comment">// since dynamic options merging is pretty slow, and none of the</span></span><br><span class="line">      <span class="comment">// internal component options needs special treatment.</span></span><br><span class="line">      initInternalComponent(vm, options)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vm.$options = mergeOptions(</span><br><span class="line">        resolveConstructorOptions(vm.constructor),</span><br><span class="line">        options || &#123;&#125;,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      initProxy(vm)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vm._renderProxy = vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// expose real self</span></span><br><span class="line">    vm._self = vm</span><br><span class="line">    initLifecycle(vm) <span class="comment">// åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸç›¸å…³</span></span><br><span class="line">    initEvents(vm) <span class="comment">// åˆå§‹åŒ–äº‹ä»¶ä¸­å¿ƒç›¸å…³</span></span><br><span class="line">    initRender(vm) <span class="comment">// åˆå§‹åŒ–æ¸²æŸ“ç›¸å…³</span></span><br><span class="line">    callHook(vm, <span class="string">'beforeCreate'</span>) </span><br><span class="line">    initInjections(vm) <span class="comment">// resolve injections before data/props</span></span><br><span class="line">    <span class="comment">// æ•°æ®åˆå§‹åŒ–ï¼Œå“åº”å¼åŸç† start</span></span><br><span class="line">    initState(vm) <span class="comment">// å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯æˆ‘ä»¬çš„ç›®æ ‡</span></span><br><span class="line">    <span class="comment">// æ•°æ®åˆå§‹åŒ–ï¼Œå“åº”å¼åŸç† end</span></span><br><span class="line">    initProvide(vm) <span class="comment">// resolve provide after data/props</span></span><br><span class="line">    callHook(vm, <span class="string">'created'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">      vm._name = formatComponentName(vm, <span class="literal">false</span>)</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(<span class="string">`vue <span class="subst">$&#123;vm._name&#125;</span> init`</span>, startTag, endTag)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (vm.$options.el) &#123;</span><br><span class="line">      vm.$mount(vm.$options.el)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// initState æ•°æ®åˆå§‹åŒ–ã€‚æ ¹æ®ä½ ä¼ å…¥çš„optionsçš„å†…å®¹å†³å®šéœ€è¦è·‘å“ªäº›å¯¹åº”çš„æ•°æ®åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initState</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._watchers = []</span><br><span class="line">  <span class="keyword">const</span> opts = vm.$options</span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œçš„åˆå§‹åŒ–å…¶å®æ²¡æœ‰å•¥ç‰¹åˆ«çš„ä¸œè¥¿ï¼Œä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š</span></span><br><span class="line">  <span class="comment">// 1. æ•°æ®æ˜¯å¦é‡å¤å£°æ˜</span></span><br><span class="line">  <span class="comment">// 2. é€šè¿‡proxyå¤„ç†æ•°æ®ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡this.xxæ¥è®¿é—®æ•°æ®</span></span><br><span class="line">  <span class="comment">// 3. å¯¹ä¼ å…¥çš„æ•°æ®åšå“åº”å¼å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (opts.props) initProps(vm, opts.props)</span><br><span class="line">  <span class="keyword">if</span> (opts.methods) initMethods(vm, opts.methods)</span><br><span class="line">  <span class="keyword">if</span> (opts.data) &#123;</span><br><span class="line">    initData(vm)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    observe(vm._data = &#123;&#125;, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (opts.computed) initComputed(vm, opts.computed)</span><br><span class="line">  <span class="keyword">if</span> (opts.watch &amp;&amp; opts.watch !== nativeWatch) &#123;</span><br><span class="line">    initWatch(vm, opts.watch)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ä¼ å…¥çš„dataæ•°æ®ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initData</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data = vm.$options.data</span><br><span class="line">  <span class="comment">// dataä¸ºä»€ä¹ˆæ˜¯ä»¥æ–¹æ³•ä¼ å…¥çš„ï¼Ÿ</span></span><br><span class="line">  <span class="comment">// vueå®ä¾‹å¯èƒ½æ˜¯ç»„ä»¶ã€‚è€Œå¯¹äºç»„ä»¶æ¥è¯´ï¼Œæ¯ä¸ªç»„ä»¶çš„dataåº”è¯¥æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œä¸èƒ½äº’ç›¸å½±å“ã€‚ </span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥è¯´dataä¸ºä»€ä¹ˆæ¨èçš„æ˜¯ä¼ å…¥function</span></span><br><span class="line">  data = vm._data = <span class="keyword">typeof</span> data === <span class="string">'function'</span></span><br><span class="line">    ? getData(data, vm)</span><br><span class="line">    : data || &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (!isPlainObject(data)) &#123;</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">      <span class="string">'data functions should return an object:\n'</span> +</span><br><span class="line">      <span class="string">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span>,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// proxy data on instance</span></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(data)</span><br><span class="line">  <span class="keyword">const</span> props = vm.$options.props</span><br><span class="line">  <span class="keyword">const</span> methods = vm.$options.methods</span><br><span class="line">  <span class="keyword">let</span> i = keys.length</span><br><span class="line">  <span class="comment">// é˜²æ­¢é‡å¤å˜é‡å£°æ˜</span></span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (methods &amp;&amp; hasOwn(methods, key)) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">`Method "<span class="subst">$&#123;key&#125;</span>" has already been defined as a data property.`</span>,</span><br><span class="line">          vm</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (props &amp;&amp; hasOwn(props, key)) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">        <span class="string">`The data property "<span class="subst">$&#123;key&#125;</span>" is already declared as a prop. `</span> +</span><br><span class="line">        <span class="string">`Use prop default value instead.`</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isReserved(key)) &#123;</span><br><span class="line">    <span class="comment">// ä»£ç†æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çš„this.xxå±æ€§å®é™…æ˜¯è®¿é—®çš„this._data.xx</span></span><br><span class="line">      proxy(vm, <span class="string">`_data`</span>, key) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// observe data</span></span><br><span class="line">  <span class="comment">// é‡ç‚¹åœ°æ–¹ï¼Œ å“åº”å¼å¤„ç†çš„æ–¹æ³•</span></span><br><span class="line">  observe(data, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="observe"><a class="header-anchor" href="#observe"></a>observe</h3>
<p><code>observe</code>å®šä¹‰åœ¨<code>core/instance/observer.js</code>ä¸­ã€‚æˆ‘ä»¬çœ‹ä¸‹<code>observe</code>é‡Œåšäº†å“ªäº›äº‹æƒ…ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observe</span> (<span class="params">value: any, asRootData: ?boolean</span>): <span class="title">Observer</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡ä»¥åŠæ˜¯å¦ä¸ºv-dom</span></span><br><span class="line">  <span class="keyword">if</span> (!isObject(value) || value <span class="keyword">instanceof</span> VNode) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ob: Observer | <span class="keyword">void</span></span><br><span class="line">  <span class="keyword">if</span> (hasOwn(value, <span class="string">'__ob__'</span>) &amp;&amp; value.__ob__ <span class="keyword">instanceof</span> Observer) &#123;</span><br><span class="line">  <span class="comment">// ç¼“å­˜å¤„ç†</span></span><br><span class="line">    ob = value.__ob__</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    shouldObserve &amp;&amp;</span><br><span class="line">    !isServerRendering() &amp;&amp;</span><br><span class="line">    (<span class="built_in">Array</span>.isArray(value) || isPlainObject(value)) &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.isExtensible(value) &amp;&amp;</span><br><span class="line">    !value._isVue</span><br><span class="line">  ) &#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ªObserverç±»</span></span><br><span class="line">    ob = <span class="keyword">new</span> Observer(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (asRootData &amp;&amp; ob) &#123;</span><br><span class="line">    ob.vmCount++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ob</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>observe()</code>ä¸»è¦æ˜¯å¯¹ä¼ å…¥çš„<code>value</code>åšäº†æ˜¯å¦ç¼“å­˜è¿‡çš„åˆ¤æ–­ï¼Œç„¶åè¿”å›çš„ä»ç„¶æ˜¯ä¸€ä¸ª<code>Observer</code>å®ä¾‹å¯¹è±¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>Observer</code>é‡Œåšäº†ä»€ä¹ˆå¤„ç†</p>
<h3 id="Observer"><a class="header-anchor" href="#Observer"></a>Observer</h3>
<p>Observerçš„å®šä¹‰å’Œobserveæ–¹æ³•åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>Observer</code>æ˜¯ä¸€ä¸ªç±»ã€‚æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªç±»ä¸­åšäº†å“ªäº›å¤„ç†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arrayProto = <span class="built_in">Array</span>.prototype</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> arrayMethods = <span class="built_in">Object</span>.create(arrayProto)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">protoAugment</span> (<span class="params">target, src: Object</span>) </span>&#123;</span><br><span class="line">  target.__proto__ = src</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  value: any;</span><br><span class="line">  dep: Dep;</span><br><span class="line">  <span class="comment">// number of vms that have this object as root $data</span></span><br><span class="line">  vmCount: number; </span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span> (value: any) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value <span class="comment">// ä¼ å…¥å€¼</span></span><br><span class="line">    <span class="keyword">this</span>.dep = <span class="keyword">new</span> Dep() <span class="comment">// å£°æ˜Depç±»</span></span><br><span class="line">    <span class="keyword">this</span>.vmCount = <span class="number">0</span> </span><br><span class="line">    <span class="comment">// ç»‘å®šObserverå®ä¾‹åˆ°valueçš„__ob__å±æ€§ä¸Š</span></span><br><span class="line">    def(value, <span class="string">'__ob__'</span>, <span class="keyword">this</span>) </span><br><span class="line">    <span class="comment">// todo çœ‹ä»£ç æ³¨é‡Šè¯´æ˜¯æ‹¦æˆªï¼Œç„¶ååŠ å¼ºå¯¹arrayçš„å¤„ç†ã€‚å…·ä½“éœ€è¦çœ‹åé¢æ˜¯æ€ä¹ˆç”¨çš„ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (hasProto) &#123;</span><br><span class="line">        protoAugment(value, arrayMethods) </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        copyAugment(value, arrayMethods, arrayKeys)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.observeArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.walk(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Walk through all properties and convert them into</span></span><br><span class="line"><span class="comment">   * getter/setters. This method should only be called when</span></span><br><span class="line"><span class="comment">   * value type is Object.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  walk (obj: <span class="built_in">Object</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">      defineReactive(obj, keys[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Observe a list of Array items.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  observeArray (items: <span class="built_in">Array</span>&lt;any&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = items.length; i &lt; l; i++) &#123;</span><br><span class="line">      observe(items[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹å¯¹è±¡åšä¸€ä¸ªå£°æ˜</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">def</span> (<span class="params">obj: Object, key: string, val: any, enumerable?: boolean</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    value: val,</span><br><span class="line">    enumerable: !!enumerable,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢å¯ä»¥çŸ¥é“ï¼Œ<code>Observer</code>ç±»å°±æ˜¯ç»™ä¼ å…¥çš„<code>object/array</code>è®¾ç½®<code>getter</code>å’Œ<code>setter</code>ï¼Œå¹¶æ²¡æœ‰åšä»€ä¹ˆå¤ªå¤šçš„å¤„ç†ï¼Œå°±æ˜¯å£°æ˜äº†ä¸€ä¸ª<code>Dep</code>ç±»ã€‚ç„¶åæŠŠè‡ªèº«å®ä¾‹è®¾ç½®åˆ°<code>value</code>çš„<code>__ob__</code>å±æ€§ä¸Šï¼Œæœ€åå°±æ˜¯å¯¹å¯¹è±¡å’Œæ•°ç»„çš„å·®å¼‚åŒ–å¤„ç†ã€‚</p>
<h3 id="defineReactive"><a class="header-anchor" href="#defineReactive"></a>defineReactive</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™æ‰æ˜¯çœŸæ­£å£°æ˜ä¸€ä¸ªå“åº”å¼å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  obj: Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  key: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  val: any,</span></span></span><br><span class="line"><span class="function"><span class="params">  customSetter?: ?Function,</span></span></span><br><span class="line"><span class="function"><span class="params">  shallow?: boolean</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦å¯ä»¥æ”¹å˜objçš„å€¼</span></span><br><span class="line">  <span class="keyword">const</span> property = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, key)</span><br><span class="line">  <span class="keyword">if</span> (property &amp;&amp; property.configurable === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// cater for pre-defined getter/setters</span></span><br><span class="line">  <span class="keyword">const</span> getter = property &amp;&amp; property.get</span><br><span class="line">  <span class="keyword">const</span> setter = property &amp;&amp; property.set</span><br><span class="line">  <span class="keyword">if</span> ((!getter || setter) &amp;&amp; <span class="built_in">arguments</span>.length === <span class="number">2</span>) &#123;</span><br><span class="line">    val = obj[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> childOb = !shallow &amp;&amp; observe(val)</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">get</span>: function reactiveGetter () &#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.call(obj) : val</span><br><span class="line">      <span class="comment">// ä¾èµ–æ”¶é›†</span></span><br><span class="line">      <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">        dep.depend()</span><br><span class="line">        <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">          childOb.dep.depend()</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">            dependArray(value)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>: function reactiveSetter (newVal) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.call(obj) : val</span><br><span class="line">      <span class="comment">/* eslint-disable no-self-compare */</span></span><br><span class="line">      <span class="keyword">if</span> (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/* eslint-enable no-self-compare */</span></span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; customSetter) &#123;</span><br><span class="line">        customSetter()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// #7981: for accessor properties without setter</span></span><br><span class="line">      <span class="keyword">if</span> (getter &amp;&amp; !setter) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">        setter.call(obj, newVal)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val = newVal</span><br><span class="line">      &#125;</span><br><span class="line">      childOb = !shallow &amp;&amp; observe(newVal)</span><br><span class="line">      <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">      dep.notify()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ<code>defineReactive()</code>ä¸»è¦æ˜¯é€šè¿‡<code>Object.defineProperty()</code>å¯¹<code>obj</code>è®¾ç½®<code>getter</code>å’Œ<code>setter</code>ã€‚å¹¶ä¸”è¿˜å¯¹<code>childObj</code>è¿›è¡Œäº†<code>observe</code>æ“ä½œï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä¸ç®¡<code>obj</code>çš„ç»“æ„å¤šå¤æ‚ï¼Œéƒ½èƒ½å¤ŸæŠŠå­å±æ€§å˜æˆå“åº”å¼å¯¹è±¡å¹¶èƒ½åœ¨è®¿é—®æˆ–ä¿®æ”¹æ—¶åŠæ—¶çš„è§¦å‘<code>getter</code>æˆ–<code>setter</code>ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨<code>getter</code>ä¸­è¿›è¡Œä¾èµ–æ”¶é›†çš„æ“ä½œï¼Œåœ¨<code>setter</code>ä¸­è§¦å‘æ›´æ–°çš„æ“ä½œã€‚</p>
<h3 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“"></a>æ€»ç»“</h3>
<p><code>vue</code>çš„å“åº”å¼æ ¸å¿ƒå°±æ˜¯é€šè¿‡<code>Object.defineProperty()</code>æ¥å¯¹ä¼ å…¥å¯¹è±¡æ·»åŠ <code>getter</code>å’Œ<code>setter</code>ã€‚ç”±äºç¯‡å¹…å·²ç»æŒºé•¿çš„äº†ï¼Œä¹‹åçš„ä¾èµ–æ”¶é›†å’Œè§¦å‘æ›´æ–°æ”¾åˆ°ä¸‹ä¸€ç¯‡ã€‚</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>xzh</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://xzh97.github.io/2020/05/12/vue-reactivty/">https://xzh97.github.io/2020/05/12/vue-reactivty/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>æœ€æ˜¯äººé—´å­¤æ„¤éš¾å¹³ï¼Œç›´æ¶ˆå¾—å‡ å›æ½®è½åˆæ½®ç”Ÿï¼</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/vue/"># vue</a>
                    
                        <a href="/tags/%E6%BA%90%E7%A0%81/"># æºç </a>
                    
                        <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/"># å“åº”å¼</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/07/22/component-design-custom-transfer/">ç»„ä»¶è®¾è®¡æ€è€ƒ-CustomTransfer</a>
            
            
            <a class="next" rel="next" href="/2020/01/15/url-parse/">ä»è¾“å…¥URLåˆ°é¡µé¢å±•ç¤ºçš„è¿‡ç¨‹</a>
            
        </section>

        
        
        <script type="text/javascript" async>
    let gitalkContainer = document.createElement('div')
    let postWrap = document.querySelector('.post-wrap');
    gitalkContainer.id = 'gitalk-container'
    postWrap.appendChild(gitalkContainer);
    let params = {
    clientID: '73f1c80bba01cb73e53d',
    clientSecret: 'fb38d78684a17e97a441a4cd0db47dc642423678',
    repo: 'xzh97.github.io',
    admin: ['xzh97'],
    id: window.location.pathname,
    owner: 'xzh97',
    distractionFreeMode: false,
    }
    let gitalk = new Gitalk(params)
    gitalk.render('gitalk-container')
</script>
        

    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© xzh | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
